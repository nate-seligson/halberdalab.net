<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Object Experiment</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
    <script src="https://timbrady.org/turk/TimTurkTools.js"></script>
</head>
<body>
<p id="title"><strong>Object Experiment</strong></p>   

<span id="Instruction1">
        <p id="intruction1.0">Welcome! Thank you for participating in our study.</p>
        <p id="intruction1.1"><u>Important,</u> before you begin: </p>
        <p id="intruction1.2">Please do this experiment on a <b>laptop</b> or <b>desktop computer</b>. If you are viewing this experiment on a phone or a tablet, please close the window and return later with non-mobile device.</p>
        <p id="instruction1.3"> Second: <b>please maximize the window for this browser and tab before you continue.</b></p>
        <p id="instruction1.4"> Click 'continue' once you have maximized the window and you are ready to  move on.</p>
</span>

<div id="Instruction2">
        <p id="intruction2.0">In this experiment every trial will be more or less the same: 2 colored disks will be presented to the left and right of a central occluder. Novel letters will appeare in the two disks. The letters then will be removed, and the empty colored disks will move behind the occluder. The occluder will then be removed to display the two colored disks containing two letters. If both letters are the same as in the preview, press 1 to indicate they are the same. If one is replaced by a new letter, press 0 to indicate there is a new letter. The positions of the letters and the colors of the disks in which they appear are entirely <b>irrelevant</b> to the task, so you should base your decision solely on the letters themselves.</p>

        <p>Click 'start training' to see the training trials.</p>
</div>

<div id="Instruction3">
    <p id="intsruction3.0">Training is now complete. The experiment is about to start. The experiemnt will take around 40 mintues. </p>
    <p id="instruction3.1">Click 'start experiment' when you are ready. Remember, your job is to press 1 or 0 on the keyboard as fast as possible to indicate whether the two letters are the same as you saw before the disks move, or there is a new letter.</p>
</div>

<div id="Instruction4">
    <p id="Intsruction4.0">You can take a break now. If you are ready to continue the experiments click 'next' or press 'Enter'. </p>
</div>
<div id="Instruction5">
    <p id="Intsruction5.0">The experiment is finished. Please click 'submit' to submit your data. Thank you.</p>
</div>

<div id="Instruction6">
    <p id="Intsruction6.0">The response on your last trial was incorrect. Remember, if both letters are the same as in the preview, press 1, if they are different press 0. Please pay attention. Thank you.</p>
</div>

<div id="Instruction7">
    <p id="Intsruction7.0">The reaction time on the last trial was longer then 4.5 seconds. Please be faster. Thank you.</p>
</div>


<button id="continueInstructionButton1">continue</button>
<button id="startTrainingButton">start training</button>
<button id="nextTrainingTrialButton">next</button>
<button id="startExpButton">start experiment</button>
<button id="nextTrialButton">next</button>
<button id="submitButton">submit</button>

<div><canvas id="canvas_L" width="800" height="500"></canvas></div>
<div><canvas id="canvas_fixation" width="10" height="10"></canvas></div>
<img id="occluder", width="200",height="300", src="occluder large.png">

<img id="shape_0", width="55",height="55", src="Aset 35.jpg">
<img id="shape_1", width="55",height="55", src="Cset 35.jpg">
<img id="shape_2", width="55",height="55", src="Dset 35.jpg">
<img id="shape_3", width="55",height="55", src="Nset 35.jpg">
<img id="shape_4", width="55",height="55", src="Vset 35.jpg">

</body>
</html>

<style type="text/css">
body {
        font-family: Helvetica;
        font-size: 15pt;
        background-color: white;
        color:black;
    } 
    #title {
        font-size:18pt;
        text-align:center;
        margin:0 auto;
    }
    #Instruction1 {
        display:table;
        max-width: 50%; 
        margin: 0 auto; 
        margin-top: 0px; 
    }
    #continueInstructionButton1 {
        display: table;
        position: absolute;
        left: 50%;
        bottom: 20%;
        transform: translate(-50%, -50%);   
    }
    #startTrainingButton {
        display: none;
        position: absolute;
        left: 50%;
        bottom: 20%;
        transform: translate(-50%, -50%); 
    }
    #Instruction2 {
        display:none;
        max-width: 50%; 
        margin: 0 auto; 
        margin-top: 0px; 
        text-align:left;
    }
    #Instruction3 {
        display:none;
        max-width: 50%; 
        text-align:center;
        margin: 0 auto; 
        margin-top: 10%; 
    }
    #Instruction4 {
        font-size: 15pt;
        display:none;
        position:absolute;
        max-width: 80%; 
        text-align:center;
        margin: 0 auto;
        top: 60%;
        left: 20%;
        right: 20%;
    }
    #Instruction5 {
        font-size: 40pt;
        display:none;
        max-width: 50%; 
        margin: 0 auto; 
        margin-top: 10px; 
        text-align:center; 
    }
    #Instruction6 {
        font-size: 20pt;
        display:none;
        max-width: 50%; 
        margin: 0 auto; 
        margin-top: 20px; 
        text-align:center; 
    }
    #Instruction7 {
        font-size: 20pt;
        display:none;
        max-width: 50%; 
        margin: 0 auto; 
        margin-top: 100px; 
        text-align:center; 
    }
    #canvas_L {
        display: none;
        background-color: gray;
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%); 
    }
    #canvas_fixation {
        display: none;
        background-color: black;
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%); 
    }
    #startExpButton {
        display: none;
        position: absolute;
        left: 50%;
        bottom: 50%;
        transform: translate(-50%, -50%); 
    }
    #nextTrainingTrialButton {
        display: none;
        position: absolute;
        left: 50%;
        top: 75%;
        transform: translate(-50%, -50%);         
    }
    #nextTrialButton {
        display: none;
        position: absolute;
        left: 50%;
        top: 75%;
        transform: translate(-50%, -50%);         
    }
    #submitButton {
        display: none;
        position: absolute;
        left: 50%;
        bottom: 50%;
        transform: translate(-50%, -50%);         
    }
    #occluder {
        display: none;
        left: 50%;
        top: 50%;
    }
    #shape_0 {
        display: none;
    }
    #shape_1 {
        display: none;
    }
    #shape_2 {
        display: none;
    }
    #shape_3 {
        display: none;
    }
    #shape_4 {
        display: none;
    }
</style>

<script>
//------Set up canvas begin---------
var canvas_L = document.getElementById('canvas_L');
var ctx_L = canvas_L.getContext('2d');
var canvasWidth = canvas_L.width;
var canvasHeight = canvas_L.height;

let screenWidth = screen.width;
let screeHeight = screen.height;
//--------------------------------------
//---------SET PARAMETERS BEGIN---------
//--------------------------------------
var colorArray_1 = [];
for(i=0;i<256;i++){
    colorArray_1[i] = 'rgb(255, ' + i + ', 0)'
}
var colorArray_2 = [];
for(i=0;i<255;i++){
    colorArray_2[i] = 'rgb(' + i + ', 255, 0)'
}
colorArray_2 = colorArray_2.reverse();
var colorArray_3 = [];
for(i=0;i<255;i++){
    j = i+1;
    colorArray_3[i] = 'rgb(0, 255, ' + j + ')'
}
var colorArray_4 = [];
for(i=0;i<255;i++){
    colorArray_4[i] = 'rgb(0, ' + i + ', 255)'
}
colorArray_4 = colorArray_4.reverse();
var colorArray_5 = [];
for(i=0;i<255;i++){
    j = i+1;
    colorArray_5[i] = 'rgb(' + j + ', 0, 255)'
}
var colorArray_6 = [];
for(i=0;i<255;i++){
    colorArray_6[i] = 'rgb(255, 0, ' + i + ')'
}
colorArray_6 = colorArray_6.reverse();

colorArray1Half = colorArray_1.concat(colorArray_2);
colorArray1Half = colorArray1Half.concat(colorArray_3);
colorArray1Half = colorArray1Half.concat(colorArray_1)
colorArray1Half = colorArray1Half.concat(colorArray_2)
colorArray1Half = colorArray1Half.concat(colorArray_3)

colorArray2Half = colorArray_4.concat(colorArray_5);
colorArray2Half = colorArray2Half.concat(colorArray_6);
colorArray2Half = colorArray2Half.concat(colorArray_4)
colorArray2Half = colorArray2Half.concat(colorArray_5)
colorArray2Half = colorArray2Half.concat(colorArray_6)

colorArray = colorArray_1.concat(colorArray_2);
colorArray = colorArray.concat(colorArray_3);
colorArray = colorArray.concat(colorArray_4);
colorArray = colorArray.concat(colorArray_5);
colorArray = colorArray.concat(colorArray_6);

var responseAcceptable = false;
var freshRate = 1000/60;

var startTrialTime;
var endTrialTime;

// ======================== GET BROWSER ======================= //
// Get browser (credit to Nimesh and other users of StackOverflow)
function getBrowser() {
      if ((navigator.userAgent.indexOf("Opera") || navigator.userAgent.indexOf("OPR")) != -1) {
        return "Opera";
    } else if (navigator.userAgent.indexOf("Chrome") != -1) {
        return "Chrome";
    } else if (navigator.userAgent.indexOf("Safari") != -1) {
        return "Safari";
    } else if (navigator.userAgent.indexOf("Firefox") != -1) {
        return "Firefox";
    } else if ((navigator.userAgent.indexOf("MSIE") != -1) || (!!document.documentMode == true)) {
        // If IE > 10
        return "IE";
    } else {
        return "Unknown";
    }
}
// ======================== GET AMAZON MTURK WORKER ID ======================= //
    // Get inferred subject ID from URL (credit to Eyal Peer)
    function getSubjectID() {
      var paramstr = window.location.search.substring(1);
      var parampairs = paramstr.split("&");
      for (i in parampairs) {
        var pair = parampairs[i].split("=");
        if (pair[0] == "workerId") {
          return pair[1];
      }
  }
}
function redirect() {
        window.location = "https://jhu.sona-systems.com/webstudy_credit.aspx?experiment_id=835&credit_token=30546fab2bcf4599b4ea792fc532bfbe&survey_code="+window.subjectID
}

// ======================== POST DATA TO SERVER ======================= //
function postData() {
      // Collect responses into JSON / csv file
      var dataString = JSON.stringify(window.frame);
      // post response to server
      $.post("logTrial.py", {
        subjectID: window.subjectID,
        dataString: dataString,  
      }).done(function(){alert("Thank you! You will be redirected to the SONA website.");redirect()});
      $("#instructions").show();  
      $("#instructions").text("Please don't close yet!");  
  } 
// ======================== save DATA TO loacl ======================= //
function download(content, fileName, contentType) {
    var a = document.createElement("a");
    var file = new Blob([content], {type: contentType});
    a.href = URL.createObjectURL(file);
    a.download = fileName;
    a.click();
}

// generate 2 random numbers from 0-4, without duplication.
// var arr = [];
// while(arr.length < 2) {
//     var r = Math.floor(Math.random() * 5);
//     if(arr.indexOf(r) === -1) arr.push(r);
// }
// console.log(arr);

var shape_A_preview_tmp;
var shape_A_test_tmp;
var shape_B_preview_tmp;
var shape_B_test_tmp;
var ball_A_color;
var ball_B_color;

var vertical_tmp_A;
var vertical_tmp_B;
var vertical_tmp_array = [-50,+50];
function trialGenerator(nRepetitions,trialsInfo) {

    for (var j1 = 0; j1 < 2*nRepetitions; j1++) { 
        
        var arr = [];
        while(arr.length < 2) {
            var r = Math.floor(Math.random() * 5);
            if(arr.indexOf(r) === -1) arr.push(r);
        }
        shape_A_preview_tmp = arr[0];
        shape_A_test_tmp = shape_A_preview_tmp;
        shape_B_preview_tmp = arr[1];
        shape_B_test_tmp = shape_B_preview_tmp;   

        var arr_color = [];
        while(arr_color.length < 2) {
            var r = Math.floor(Math.random() * 5);
            if(arr_color.indexOf(r) === -1) arr_color.push(r);
        }
        ball_A_color = arr_color[0];
        ball_B_color = arr_color[1]; 

        var arr_vertical = [];
        while(arr_vertical.length < 2) {
        var r = Math.floor(Math.random() * 2);
        if(arr_vertical.indexOf(r) === -1) arr_vertical.push(r);
        }
        vertical_tmp_A = vertical_tmp_array[arr_vertical[0]];
        vertical_tmp_B = vertical_tmp_array[arr_vertical[1]];

        trialsInfo.push({
            "spatiotemporalType":"spatiotemporal_inconsistent",
            "matchType":"same",
            "shape_A_pre_ind":shape_A_preview_tmp,
            "shape_A_test_ind":shape_A_test_tmp,
            "shape_B_pre_ind":shape_B_preview_tmp,
            "shape_B_test_ind":shape_B_test_tmp,  
            "ball_A_color":ball_A_color,
            "ball_B_color":ball_B_color,   
            "ball_A_color_change_rate":25,
            "ball_B_color_change_rate":0,   
            "ball_A_vertical":vertical_tmp_A,
            "ball_B_vertical":vertical_tmp_B,
            "responseC": "null",
            "browser": getBrowser(),
            "subjectID": getSubjectID(),
            "startTime": "null",
            "endTime": "null",
            "reactTime":"null",
        });                  
    }

    for (var j1 = 0; j1 < 2*nRepetitions; j1++) { 
        
        var arr = [];
        while(arr.length < 2) {
            var r = Math.floor(Math.random() * 5);
            if(arr.indexOf(r) === -1) arr.push(r);
        }
        shape_A_preview_tmp = arr[0];
        shape_A_test_tmp = shape_A_preview_tmp;
        shape_B_preview_tmp = arr[1];
        shape_B_test_tmp = shape_B_preview_tmp;   

        var arr_color = [];
        while(arr_color.length < 2) {
            var r = Math.floor(Math.random() * 5);
            if(arr_color.indexOf(r) === -1) arr_color.push(r);
        }
        ball_A_color = arr_color[0];
        ball_B_color = arr_color[1]; 

        var arr_vertical = [];
        while(arr_vertical.length < 2) {
        var r = Math.floor(Math.random() * 2);
        if(arr_vertical.indexOf(r) === -1) arr_vertical.push(r);
        }
        vertical_tmp_A = vertical_tmp_array[arr_vertical[0]];
        vertical_tmp_B = vertical_tmp_array[arr_vertical[1]];

        trialsInfo.push({
            "spatiotemporalType":"spatiotemporal_inconsistent",
            "matchType":"same",
            "shape_A_pre_ind":shape_A_preview_tmp,
            "shape_A_test_ind":shape_A_test_tmp,
            "shape_B_pre_ind":shape_B_preview_tmp,
            "shape_B_test_ind":shape_B_test_tmp,  
            "ball_A_color":ball_A_color,
            "ball_B_color":ball_B_color,   
            "ball_A_color_change_rate":0,
            "ball_B_color_change_rate":25,   
            "ball_A_vertical":vertical_tmp_A,
            "ball_B_vertical":vertical_tmp_B,
            "responseC": "null",
            "browser": getBrowser(),
            "subjectID": getSubjectID(),
            "startTime": "null",
            "endTime": "null",
            "reactTime":"null",
        });                  
    }


    for (var j1 = 0; j1 < nRepetitions; j1++) {

        var arr = [];
        while(arr.length < 3) {
            var r = Math.floor(Math.random() * 5);
            if(arr.indexOf(r) === -1) arr.push(r);
        }
        shape_A_preview_tmp = arr[0];
        shape_A_test_tmp = shape_A_preview_tmp;
        shape_B_preview_tmp = arr[1];
        shape_B_test_tmp = arr[2];   

        var arr_color = [];
        while(arr_color.length < 2) {
            var r = Math.floor(Math.random() * 5);
            if(arr_color.indexOf(r) === -1) arr_color.push(r);
        }
        ball_A_color = arr_color[0];
        ball_B_color = arr_color[1];

        var arr_vertical = [];
        while(arr_vertical.length < 2) {
        var r = Math.floor(Math.random() * 2);
        if(arr_vertical.indexOf(r) === -1) arr_vertical.push(r);
        }
        vertical_tmp_A = vertical_tmp_array[arr_vertical[0]];
        vertical_tmp_B = vertical_tmp_array[arr_vertical[1]];

        trialsInfo.push({
            "spatiotemporalType":"spatiotemporal_inconsistent",
            "matchType":"new",
            "shape_A_pre_ind":shape_A_preview_tmp,
            "shape_A_test_ind":shape_A_test_tmp,
            "shape_B_pre_ind":shape_B_preview_tmp,
            "shape_B_test_ind":shape_B_test_tmp,
            "ball_A_color":ball_A_color,
            "ball_B_color":ball_B_color,   
            "ball_A_color_change_rate":25,
            "ball_B_color_change_rate":0,   
            "ball_A_vertical":vertical_tmp_A,
            "ball_B_vertical":vertical_tmp_B,
            "responseC": "null",
            "browser": getBrowser(),
            "subjectID": getSubjectID(),
            "startTime": "null",
            "endTime": "null",
            "reactTime":"null",
        });
    }

    for (var j1 = 0; j1 < nRepetitions; j1++) {

        var arr = [];
        while(arr.length < 3) {
            var r = Math.floor(Math.random() * 5);
            if(arr.indexOf(r) === -1) arr.push(r);
        }
        shape_A_preview_tmp = arr[0];
        shape_A_test_tmp = shape_A_preview_tmp;
        shape_B_preview_tmp = arr[1];
        shape_B_test_tmp = arr[2];   

        var arr_color = [];
        while(arr_color.length < 2) {
            var r = Math.floor(Math.random() * 5);
            if(arr_color.indexOf(r) === -1) arr_color.push(r);
        }
        ball_A_color = arr_color[0];
        ball_B_color = arr_color[1];

        var arr_vertical = [];
        while(arr_vertical.length < 2) {
        var r = Math.floor(Math.random() * 2);
        if(arr_vertical.indexOf(r) === -1) arr_vertical.push(r);
        }
        vertical_tmp_A = vertical_tmp_array[arr_vertical[0]];
        vertical_tmp_B = vertical_tmp_array[arr_vertical[1]];

        trialsInfo.push({
            "spatiotemporalType":"spatiotemporal_inconsistent",
            "matchType":"new",
            "shape_A_pre_ind":shape_A_preview_tmp,
            "shape_A_test_ind":shape_A_test_tmp,
            "shape_B_pre_ind":shape_B_preview_tmp,
            "shape_B_test_ind":shape_B_test_tmp,
            "ball_A_color":ball_A_color,
            "ball_B_color":ball_B_color,   
            "ball_A_color_change_rate":0,
            "ball_B_color_change_rate":25,   
            "ball_A_vertical":vertical_tmp_A,
            "ball_B_vertical":vertical_tmp_B,
            "responseC": "null",
            "browser": getBrowser(),
            "subjectID": getSubjectID(),
            "startTime": "null",
            "endTime": "null",
            "reactTime":"null",
        });
    }

    for (var j1 = 0; j1 < nRepetitions; j1++) {
        
        var arr = [];
        while(arr.length < 3) {
            var r = Math.floor(Math.random() * 5);
            if(arr.indexOf(r) === -1) arr.push(r);
        }
        shape_A_preview_tmp = arr[0];
        shape_A_test_tmp = arr[1];
        shape_B_preview_tmp = arr[2];
        shape_B_test_tmp = shape_B_preview_tmp;

        var arr_color = [];
        while(arr_color.length < 2) {
            var r = Math.floor(Math.random() * 5);
            if(arr_color.indexOf(r) === -1) arr_color.push(r);
        }
        ball_A_color = arr_color[0];
        ball_B_color = arr_color[1];

        var arr_vertical = [];
        while(arr_vertical.length < 2) {
        var r = Math.floor(Math.random() * 2);
        if(arr_vertical.indexOf(r) === -1) arr_vertical.push(r);
        }
        vertical_tmp_A = vertical_tmp_array[arr_vertical[0]];
        vertical_tmp_B = vertical_tmp_array[arr_vertical[1]];

        trialsInfo.push({
            "spatiotemporalType":"spatiotemporal_inconsistent",
            "matchType":"new",
            "shape_A_pre_ind":shape_A_preview_tmp,
            "shape_A_test_ind":shape_A_test_tmp,
            "shape_B_pre_ind":shape_B_preview_tmp,
            "shape_B_test_ind":shape_B_test_tmp,
            "ball_A_color":ball_A_color,
            "ball_B_color":ball_B_color,   
            "ball_A_color_change_rate":25,
            "ball_B_color_change_rate":0,   
            "ball_A_vertical":vertical_tmp_A,
            "ball_B_vertical":vertical_tmp_B,
            "responseC": "null",
            "browser": getBrowser(),
            "subjectID": getSubjectID(),
            "startTime": "null",
            "endTime": "null",
            "reactTime":"null",
        });
    }

    for (var j1 = 0; j1 < nRepetitions; j1++) {
        
        var arr = [];
        while(arr.length < 3) {
            var r = Math.floor(Math.random() * 5);
            if(arr.indexOf(r) === -1) arr.push(r);
        }
        shape_A_preview_tmp = arr[0];
        shape_A_test_tmp = arr[1];
        shape_B_preview_tmp = arr[2];
        shape_B_test_tmp = shape_B_preview_tmp;

        var arr_color = [];
        while(arr_color.length < 2) {
            var r = Math.floor(Math.random() * 5);
            if(arr_color.indexOf(r) === -1) arr_color.push(r);
        }
        ball_A_color = arr_color[0];
        ball_B_color = arr_color[1];

        var arr_vertical = [];
        while(arr_vertical.length < 2) {
        var r = Math.floor(Math.random() * 2);
        if(arr_vertical.indexOf(r) === -1) arr_vertical.push(r);
        }
        vertical_tmp_A = vertical_tmp_array[arr_vertical[0]];
        vertical_tmp_B = vertical_tmp_array[arr_vertical[1]];

        trialsInfo.push({
            "spatiotemporalType":"spatiotemporal_inconsistent",
            "matchType":"new",
            "shape_A_pre_ind":shape_A_preview_tmp,
            "shape_A_test_ind":shape_A_test_tmp,
            "shape_B_pre_ind":shape_B_preview_tmp,
            "shape_B_test_ind":shape_B_test_tmp,
            "ball_A_color":ball_A_color,
            "ball_B_color":ball_B_color,   
            "ball_A_color_change_rate":0,
            "ball_B_color_change_rate":25,   
            "ball_A_vertical":vertical_tmp_A,
            "ball_B_vertical":vertical_tmp_B,
            "responseC": "null",
            "browser": getBrowser(),
            "subjectID": getSubjectID(),
            "startTime": "null",
            "endTime": "null",
            "reactTime":"null",
        });
    }

    for (var j1 = 0; j1 < 2*nRepetitions; j1++) {
        
        var arr = [];
        while(arr.length < 2) {
            var r = Math.floor(Math.random() * 5);
            if(arr.indexOf(r) === -1) arr.push(r);
        }
        shape_A_preview_tmp = arr[0];
        shape_B_preview_tmp = arr[1];
        shape_A_test_tmp = shape_B_preview_tmp;
        shape_B_test_tmp = shape_A_preview_tmp;

        var arr_color = [];
        while(arr_color.length < 2) {
            var r = Math.floor(Math.random() * 5);
            if(arr_color.indexOf(r) === -1) arr_color.push(r);
        }
        ball_A_color = arr_color[0];
        ball_B_color = arr_color[1];

        var arr_vertical = [];
        while(arr_vertical.length < 2) {
        var r = Math.floor(Math.random() * 2);
        if(arr_vertical.indexOf(r) === -1) arr_vertical.push(r);
        }
        vertical_tmp_A = vertical_tmp_array[arr_vertical[0]];
        vertical_tmp_B = vertical_tmp_array[arr_vertical[1]];

        trialsInfo.push({
            "spatiotemporalType":"spatiotemporal_inconsistent",
            "matchType":"same_swap",
            "shape_A_pre_ind":shape_A_preview_tmp,
            "shape_A_test_ind":shape_A_test_tmp,
            "shape_B_pre_ind":shape_B_preview_tmp,
            "shape_B_test_ind":shape_B_test_tmp,
            "ball_A_color":ball_A_color,
            "ball_B_color":ball_B_color,   
            "ball_A_color_change_rate":25,
            "ball_B_color_change_rate":0,   
            "ball_A_vertical":vertical_tmp_A,
            "ball_B_vertical":vertical_tmp_B,
            "responseC": "null",
            "browser": getBrowser(),
            "subjectID": getSubjectID(),
            "startTime": "null",
            "endTime": "null",
            "reactTime":"null",
        });
    }
    for (var j1 = 0; j1 < 2*nRepetitions; j1++) {
        
        var arr = [];
        while(arr.length < 2) {
            var r = Math.floor(Math.random() * 5);
            if(arr.indexOf(r) === -1) arr.push(r);
        }
        shape_A_preview_tmp = arr[0];
        shape_B_preview_tmp = arr[1];
        shape_A_test_tmp = shape_B_preview_tmp;
        shape_B_test_tmp = shape_A_preview_tmp;

        var arr_color = [];
        while(arr_color.length < 2) {
            var r = Math.floor(Math.random() * 5);
            if(arr_color.indexOf(r) === -1) arr_color.push(r);
        }
        ball_A_color = arr_color[0];
        ball_B_color = arr_color[1];

        var arr_vertical = [];
        while(arr_vertical.length < 2) {
        var r = Math.floor(Math.random() * 2);
        if(arr_vertical.indexOf(r) === -1) arr_vertical.push(r);
        }
        vertical_tmp_A = vertical_tmp_array[arr_vertical[0]];
        vertical_tmp_B = vertical_tmp_array[arr_vertical[1]];

        trialsInfo.push({
            "spatiotemporalType":"spatiotemporal_inconsistent",
            "matchType":"same_swap",
            "shape_A_pre_ind":shape_A_preview_tmp,
            "shape_A_test_ind":shape_A_test_tmp,
            "shape_B_pre_ind":shape_B_preview_tmp,
            "shape_B_test_ind":shape_B_test_tmp,
            "ball_A_color":ball_A_color,
            "ball_B_color":ball_B_color,   
            "ball_A_color_change_rate":0,
            "ball_B_color_change_rate":25,   
            "ball_A_vertical":vertical_tmp_A,
            "ball_B_vertical":vertical_tmp_B,
            "responseC": "null",
            "browser": getBrowser(),
            "subjectID": getSubjectID(),
            "startTime": "null",
            "endTime": "null",
            "reactTime":"null",
        });
    }
    trialsInfo = shuffle(trialsInfo);
    return trialsInfo;
}

var trialsInfo = [];
var nRepetitions = 22;//44
var frame = trialGenerator(nRepetitions,trialsInfo);
var nTrials = frame.length;

var trialsInfo_training = [];
var nRepetitions_training = 1;//2
var frame_training = trialGenerator(nRepetitions_training,trialsInfo_training);
var nTrials_training = frame_training.length;

var browser = getBrowser();
var subjectID = getSubjectID();

//---------------------------------------
//-----------FUNCTIONS BEGIN-------------
//---------------------------------------
/* Fisher-Yates shuffle */
function shuffle(o){
    for(var j, x, i = o.length; i; j = Math.floor(Math.random() * i), x = o[--i], o[i] = o[j], o[j] = x);
        return o;
}
function random(min,max) {
    const num = Math.floor(Math.random() * (max - min)) + min;
    return num;
}
function Ball(x,y,color,size) {
    this.x = x;
    this.y = y;
    this.color = color;
    this.size = size;
};
var nDots = 1; 
var dotRadius = 40; //Radius of each dot in pixels
var balls = [];
// colorNumb = 10, red/200, yellow/380, green/1000, blue/1200, purple
var balls_colorArray = [10,200,380,1000,1200];
var colorInd;
var x_0_A;
var y_0_A;
function generateNewBalls_A(ball_A_color) { // the ball on the left at beginning
    colorInd = balls_colorArray[ball_A_color];
    let colorNums = [];
    var x_0s = [];
    var y_0s = [];
    var dist_tmp = [];
    x_0_A = canvasWidth/2-230;
    y_0_A = canvasHeight/2;
    x_0s.push(x_0_A);
    y_0s.push(y_0_A);
    var colorNum = colorInd;
    let ball = new Ball(
        x_0_A,
        y_0_A,
        colorArray[colorNum],
        dotRadius,
        );
    balls.push(ball);
    colorNums.push(colorNum);
    return balls;
}
var x_0_B;
var y_0_B;
function generateNewBalls_B(ball_B_color) { // the ball on the right at beginning
    colorInd = balls_colorArray[ball_B_color];
    let colorNums = [];
    var x_0s = [];
    var y_0s = [];
    var dist_tmp = [];
    x_0_B = canvasWidth/2+230;
    y_0_B = canvasHeight/2;
    x_0s.push(x_0_B);
    y_0s.push(y_0_B);
    var colorNum = colorInd;
    let ball = new Ball(
        x_0_B,
        y_0_B,
        colorArray[colorNum],
        dotRadius,
        );
    balls.push(ball);
    colorNums.push(colorNum);
    return balls;
}
Ball.prototype.draw_balls = function() {
    ctx_L.beginPath();
    ctx_L.fillStyle = this.color;
    ctx_L.arc(this.x, this.y, this.size, 0, 2 * Math.PI);
    ctx_L.fill();
};
Ball.prototype.updateColor_A = function() { // updates color, when color_change_rate is zero, no color change
    var pos = colorArray.indexOf(this.color);
    if(pos >= colorArray.length - 1 - color_change_rate_A) {
        pos = colorArray.length - 1 -  pos;
    } else {
        pos = colorArray.indexOf(this.color);
    }
    this.color = colorArray[pos+color_change_rate_A];
};
Ball.prototype.updateColor_B = function() { // updates color, when color_change_rate is zero, no color change
    var pos = colorArray.indexOf(this.color);
    if(pos >= colorArray.length - 1 - color_change_rate_B) {
        pos = colorArray.length - 1 -  pos;
    } else {
        pos = colorArray.indexOf(this.color);
    }
    this.color = colorArray[pos+color_change_rate_B];
};


Ball.prototype.updateColor_A_1 = function() { // updates color in first half of color space, used pre occlusion 
    var pos = colorArray.indexOf(this.color);
    if(pos >= colorArray.length - 1 - color_change_rate_A) {
        pos = colorArray.length - 1 -  pos;
    } else {
        pos = colorArray.indexOf(this.color);
    }
    if (color_change_rate_A == 0){
    this.color = colorArray[pos];
    } else {
        this.color = colorArray1Half[pos + color_change_rate_A]
    }
};


Ball.prototype.updateColor_A_2 = function() { // updates color in second half of color space, used post occlusion
    var pos = colorArray.indexOf(this.color);
    if(pos >= colorArray2Half.length - 1 - color_change_rate_A) {
        pos = colorArray2Half.length - 1 -  pos;
    } else {
        pos = colorArray.indexOf(this.color);
    }
    if (color_change_rate_A == 0){
    this.color = colorArray[pos];
    } else {
        this.color = colorArray2Half[pos + color_change_rate_A]
    }
};


Ball.prototype.updateColor_B_1 = function() { // updates color in first half of color space, used pre occlusion 
    var pos = colorArray.indexOf(this.color);
    if(pos >= colorArray1Half.length - 1 - color_change_rate_B) {
        pos = colorArray1Half.length - 1 -  pos;
    } else {
        pos = colorArray.indexOf(this.color);
    }
    if (color_change_rate_B == 0){
    this.color = colorArray[pos];
    } else {
        this.color = colorArray1Half[pos + color_change_rate_B]
    }
};



Ball.prototype.updateColor_B_2 = function() { // updates color in second half of color space, used post occlusion
    var pos = colorArray.indexOf(this.color);
    if(pos >= colorArray2Half.length - 1 - color_change_rate_B) {
        pos = colorArray2Half.length - 1 -  pos;
    } else {
        pos = colorArray.indexOf(this.color);
    }
    if (color_change_rate_B == 0){
    this.color = colorArray[pos];
    } else {
        this.color = colorArray2Half[pos + color_change_rate_B]
    }
};








var velX = 4.5;//4.5
// var velY = 1.5;
var edgeX = 100;
Ball.prototype.updatePosition_A = function() { //define the moving path
    if (this.x < canvasWidth/2) {
        this.x = this.x + velX;
        if (this.x < x_0_A+dotRadius/4) {
            this.y = this.y+10;
        }
        if (x_0_A+dotRadius/4 <= this.x && this.x < x_0_A+dotRadius/2) {
            this.y = this.y+15;
        }
        if (x_0_A+dotRadius/2 <= this.x && this.x < x_0_A+1.5*dotRadius) {
            this.y = this.y-3;
        }
        if (x_0_A+1.5*dotRadius <= this.x && this.x < x_0_A+2*dotRadius) {
            this.y = this.y;
        }
        if (x_0_A+2*dotRadius <= this.x && this.x < x_0_A+3*dotRadius) {
            this.y = this.y-3;
        }
        if (x_0_A+3*dotRadius <= this.x && this.x < x_0_A+3*dotRadius) {
            this.y = this.y+3;
        }
        if (x_0_A+3*dotRadius <= this.x && this.x < canvasWidth/2) {
            this.y = canvasHeight/2;
        }
    } 
    else {
        this.x = canvasWidth/2;
        this.y = canvasHeight/2+vertical_tmp_A;
    }
};
Ball.prototype.updatePosition_B = function() {    
    if (this.x > canvasWidth/2) {
        this.x = this.x - velX;

        if (this.x > x_0_B-dotRadius/4) {
            this.y = this.y+10;
        }
        if (x_0_B-dotRadius/2 < this.x && this.x <= x_0_B-dotRadius/4) {
            this.y = this.y+15;
        }
        if (x_0_B-1.5*dotRadius < this.x && this.x <= x_0_B-dotRadius/2) {
            this.y = this.y-3;
        }
        if (x_0_B-2*dotRadius < this.x && this.x <= x_0_B-1.5*dotRadius) {
            this.y = this.y;
        }
        if (x_0_B-3*dotRadius < this.x && this.x <= x_0_B-2*dotRadius) {
            this.y = this.y-3;
        }
        if (x_0_B-5*dotRadius < this.x && this.x <= x_0_B-5*dotRadius) {
            this.y = this.y+3;
        }
        if (canvasWidth/2 < this.x && this.x <= x_0_B-5*dotRadius) {
            this.y = canvasHeight/2;
        }
    } 
    else {
        this.x = canvasWidth/2;
        this.y = canvasHeight/2+vertical_tmp_B;
    }
};

// exp procedures 
function continueInstruction1() {
    $('#Instruction1').hide();
    $('#continueInstructionButton1').hide();
    $('#Instruction2').show(); 
    $('#startTrainingButton').show();
}
var shapeTmp;
let balls_A = [];
let balls_B = [];
var trainingTrial = 0;
function showTrials_training_0() {
    responseAcceptable = false;
    $('#title').hide();
    $('#Instruction2').hide();
    $('#startTrainingButton').hide();

    balls = generateNewBalls_A(trialsInfo_training[trainingTrial].ball_A_color);
    balls_A = balls;
    balls = [];
    balls = generateNewBalls_B(trialsInfo_training[trainingTrial].ball_B_color);
    balls_B = balls;
    balls = [];
    startTrialTime = new Date();
    trialsInfo_training[trainingTrial].startTime= startTrialTime;
    $('#canvas_L').show(); 
    animate();
}
function showTrials_training() {
    responseAcceptable = false;
    $('#Instruction4').hide();
    $('#Instruction6').hide();
    $('#Instruction7').hide();
    $('#nextTrainingTrialButton').hide();
    trainingTrial ++;

    if (trainingTrial <= trialsInfo_training.length-1) {
        balls = generateNewBalls_A(trialsInfo_training[trainingTrial].ball_A_color);
        balls_A = balls;
        balls = [];
        balls = generateNewBalls_B(trialsInfo_training[trainingTrial].ball_B_color);
        balls_B = balls;
        balls = [];
        $('#Instruction2').hide();
        ctx_L.fillStyle = 'gray';
        ctx_L.clearRect(0,0,canvas_L.width, canvas_L.height);  
         startTrialTime = new Date();
        trialsInfo_training[trainingTrial].startTime= startTrialTime;
        $('#canvas_L').show();
        animate(); 
    } else {
        $('#Instruction3').show();
        $('#startExpButton').show();
    }
}
var curTrial = 0;
function showTrials_exp_0() {
    responseAcceptable = false;
    $('#title').hide();
    $('#Instruction3').hide();
    $('#startExpButton').hide();

    balls = generateNewBalls_A(trialsInfo[curTrial].ball_A_color);
    balls_A = balls;
    balls = [];
    balls = generateNewBalls_B(trialsInfo[curTrial].ball_B_color);
    balls_B = balls;
    balls = [];

    ctx_L.fillStyle = 'gray';
    ctx_L.clearRect(0,0,canvas_L.width, canvas_L.height);  
    startTrialTime = new Date();
    trialsInfo[curTrial].startTime= startTrialTime;
    $('#canvas_L').show();
    animate();  
}
function showTrials_exp() {
    responseAcceptable = false;
    curTrial++;
    $('#Instruction4').hide();
    $('#Instruction6').hide();
    $('#Instruction7').hide();
    $('#nextTrialButton').hide();
    
    if (curTrial <= trialsInfo.length - 1) {

        balls = generateNewBalls_A(trialsInfo[curTrial].ball_A_color);
        balls_A = balls;
        balls = [];
        balls = generateNewBalls_B(trialsInfo[curTrial].ball_B_color);
        balls_B = balls;
        balls = [];

        ctx_L.fillStyle = 'gray';
        ctx_L.clearRect(0,0,canvas_L.width, canvas_L.height);  
        startTrialTime = new Date();
        trialsInfo[curTrial].startTime= startTrialTime;
        $('#canvas_L').show(); 
        animate();  
    } else {
        $('#Instruction5').show();
        $('#submitButton').show();
    }
}

var myTimeout10;
var myTimeout11;
var myTimeout12;
var shapeInd_A_pre;
var shapeInd_A_test;
var shapeInd_B_pre;
var shapeInd_B_test;
var colorDisk = 500;//500
var previewShape = 1200;

var refresh_stimuliOnset_test = 0;

var color_change_rate_A = 15;//0
var color_change_rate_B = 15;//0

var myTimeout;
var myReq;
var startResponseTiming = false;
var occluder_velX = 0;
var occluder_velY = 40;//40
var occluder_posX = 0;
var occluder_posY = 0;

function animate() { // make the balls and the shapes move together, and occluder when spatiotemporal feature is inconsistent
    myTimeout = setTimeout (function() {     
    ctx_L.fillStyle = 'gray';
    ctx_L.clearRect(0,0,canvas_L.width, canvas_L.height);

    if (trainingTrial < trialsInfo_training.length) {
        vertical_tmp_A = trialsInfo_training[trainingTrial].ball_A_vertical;
        vertical_tmp_B = trialsInfo_training[trainingTrial].ball_B_vertical;

        color_change_rate_A = trialsInfo_training[trainingTrial].ball_A_color_change_rate;
        color_change_rate_B = trialsInfo_training[trainingTrial].ball_B_color_change_rate;

        shapeInd_A_pre = trialsInfo_training[trainingTrial].shape_A_pre_ind;
        shapeInd_B_pre = trialsInfo_training[trainingTrial].shape_B_pre_ind; 
    }
    if (trainingTrial == trialsInfo_training.length && curTrial < trialsInfo.length) {
        vertical_tmp_A = trialsInfo[curTrial].ball_A_vertical;
        vertical_tmp_B = trialsInfo[curTrial].ball_B_vertical;

        color_change_rate_A = trialsInfo[curTrial].ball_A_color_change_rate;
        color_change_rate_B = trialsInfo[curTrial].ball_B_color_change_rate;

        shapeInd_A_pre = trialsInfo[curTrial].shape_A_pre_ind;
        shapeInd_B_pre = trialsInfo[curTrial].shape_B_pre_ind;
    }

    refresh_stimuliOnset_test ++;
    
    if (refresh_stimuliOnset_test < 30) {// fresh rate at the end is 16.6 ms. 76 times 16 is 1200 ms, that is what this keeps count of, so it is a timer. This period is just showing the balls and shape. 
        ctx_L.drawImage(occluder,canvasWidth/2-100,canvasHeight/2-150);

        balls_A[0].draw_balls();
        balls_A[0].updateColor_A_1();
        balls_B[0].draw_balls();
        balls_B[0].updateColor_B_1();
    }

    if (refresh_stimuliOnset_test >= 30 && refresh_stimuliOnset_test < 106) {// fresh rate at the end is 16.6 ms. 76 times 16 is 1200 ms, that is what this keeps count of, so it is a timer. This period is just showing the balls and shape. 
        ctx_L.drawImage(occluder,canvasWidth/2-100,canvasHeight/2-150);

        balls_A[0].draw_balls();
        balls_A[0].updateColor_A_1();
        balls_B[0].draw_balls();
        balls_B[0].updateColor_B_1();

        if (shapeInd_A_pre == 0) {
            shapeTmp = shape_0
        } else if (shapeInd_A_pre == 1) {
            shapeTmp = shape_1
        } else if (shapeInd_A_pre == 2) {
            shapeTmp = shape_2
        } else if (shapeInd_A_pre == 3) {
            shapeTmp = shape_3
        } else if (shapeInd_A_pre == 4) {
            shapeTmp = shape_4
        }
        ctx_L.drawImage(shapeTmp, balls_A[0].x-17, balls_A[0].y-17)

        if (shapeInd_B_pre == 0) {
            shapeTmp = shape_0
        } else if (shapeInd_B_pre == 1) {
            shapeTmp = shape_1
        } else if (shapeInd_B_pre == 2) {
            shapeTmp = shape_2
        } else if (shapeInd_B_pre == 3) {
            shapeTmp = shape_3
        } else if (shapeInd_B_pre == 4) {
            shapeTmp = shape_4
        }
        ctx_L.drawImage(shapeTmp, balls_B[0].x-17, balls_B[0].y-17)
    }

    if (refresh_stimuliOnset_test >= 106 && refresh_stimuliOnset_test < 206) {// this is the movement part. 
        balls_A[0].draw_balls();
        balls_A[0].updateColor_A_1();
        balls_A[0].updatePosition_A();

        balls_B[0].draw_balls();
        balls_B[0].updateColor_B_1();
        balls_B[0].updatePosition_B();

        ctx_L.drawImage(occluder,canvasWidth/2-100,canvasHeight/2-150);
    }
    
    if (refresh_stimuliOnset_test >= 206 && refresh_stimuliOnset_test <= 230) {// this is the occlusion part
        balls_A[0].draw_balls();
        balls_A[0].updateColor_A_1();
        balls_A[0].updatePosition_A();
        
        balls_B[0].draw_balls();
        balls_B[0].updateColor_B_1();
        balls_B[0].updatePosition_B();

        ctx_L.drawImage(occluder,canvasWidth/2-100-occluder_posX,canvasHeight/2-150-occluder_posY);
    }  

    if (refresh_stimuliOnset_test >= 230 && refresh_stimuliOnset_test <= 260) {//this is the reveal part without shapes

        if (trainingTrial <= trialsInfo_training.length-1) {
            shapeInd_A_test = trialsInfo_training[trainingTrial].shape_A_test_ind;
            shapeInd_B_test = trialsInfo_training[trainingTrial].shape_B_test_ind;
        }

        if (trainingTrial == trialsInfo_training.length && curTrial>=0) {
            shapeInd_A_test = trialsInfo[curTrial].shape_A_test_ind;
            shapeInd_B_test = trialsInfo[curTrial].shape_B_test_ind;
        }

        balls_A[0].draw_balls();
        balls_A[0].updateColor_A_2();
        balls_A[0].updatePosition_A();
        
        balls_B[0].draw_balls();
        balls_B[0].updateColor_B_2();
        balls_B[0].updatePosition_B();

        ctx_L.drawImage(occluder,canvasWidth/2-100-occluder_posX,canvasHeight/2-150-occluder_posY);
        occluder_posY = occluder_posY + occluder_velY;
    }

    if (refresh_stimuliOnset_test > 260) {//this is the reveal part

        if (trainingTrial <= trialsInfo_training.length-1) {
            shapeInd_A_test = trialsInfo_training[trainingTrial].shape_A_test_ind;
            shapeInd_B_test = trialsInfo_training[trainingTrial].shape_B_test_ind;
        }

        if (trainingTrial == trialsInfo_training.length && curTrial>=0) {
            shapeInd_A_test = trialsInfo[curTrial].shape_A_test_ind;
            shapeInd_B_test = trialsInfo[curTrial].shape_B_test_ind;
        }

        balls_A[0].draw_balls();
        balls_A[0].updateColor_A_2();
        balls_A[0].updatePosition_A();
        
        balls_B[0].draw_balls();
        balls_B[0].updateColor_B_2();
        balls_B[0].updatePosition_B();

        if (shapeInd_A_test == 0) {
            shapeTmp = shape_0
        } else if (shapeInd_A_test == 1) {
            shapeTmp = shape_1
        } else if (shapeInd_A_test == 2) {
            shapeTmp = shape_2
        } else if (shapeInd_A_test == 3) {
            shapeTmp = shape_3
        } else if (shapeInd_A_test == 4) {
            shapeTmp = shape_4
        }
        ctx_L.drawImage(shapeTmp, balls_A[0].x-17, balls_A[0].y-17);
        
        if (shapeInd_B_test == 0) {
            shapeTmp = shape_0
        } else if (shapeInd_B_test == 1) {
            shapeTmp = shape_1
        } else if (shapeInd_B_test == 2) {
            shapeTmp = shape_2
        } else if (shapeInd_B_test == 3) {
            shapeTmp = shape_3
        } else if (shapeInd_B_test == 4) {
            shapeTmp = shape_4
        }
        ctx_L.drawImage(shapeTmp, balls_B[0].x-17, balls_B[0].y-17);
        
        

        responseAcceptable = true; // only allow response when the occlude is removed/equivalent time in no occluder condition
    }

        myReq = requestAnimationFrame(animate);
    }, freshRate)
};
let repsonse_tmp;
let rt_tmp;
// record keyboard response
window.addEventListener('keydown', function(e) {
if (responseAcceptable == true) {
    if (e.key == '1') {
        endTrialTime = new Date();
        window.cancelAnimationFrame(myReq);
        clearTimeout(myTimeout);
        refresh_stimuliOnset_test = 0;
        occluder_velX = 0;
        occluder_velY = 40;//40
        occluder_posX = 0;
        occluder_posY = 0;
        $('#canvas_L').hide();
        $('#Instruction4').show();
        if (trainingTrial <= trialsInfo_training.length-1) {
            $('#nextTrainingTrialButton').show();
        } 
        if (trainingTrial == trialsInfo_training.length && curTrial>=0) {
            $('#nextTrialButton').show();
        }
        balls_A[0].x = canvasWidth/2-230;
        balls_A[0].y = canvasHeight/2;
        balls_B[0].x = canvasWidth/2+230;
        balls_B[0].y = canvasHeight/2;

        if (curTrial ==0 && trainingTrial >=0 && trainingTrial < trialsInfo_training.length) {
            trialsInfo_training[trainingTrial].endTime = endTrialTime;
            trialsInfo_training[trainingTrial].reactTime = endTrialTime - startTrialTime-colorDisk-previewShape-colorDisk-76*20;
            trialsInfo_training[trainingTrial].responseC = 1;
            repsonse_tmp = trialsInfo_training[trainingTrial].responseC;
            if (trialsInfo_training[trainingTrial].matchType == 'new' && repsonse_tmp == 1) {
                $('#Instruction6').show();
            } 
            rt_tmp = trialsInfo_training[trainingTrial].reactTime;
            if (rt_tmp > 4500) {
                $('#Instruction7').show();
            }
        }

        trialsInfo[curTrial].endTime = endTrialTime;
        trialsInfo[curTrial].reactTime = endTrialTime - startTrialTime-colorDisk-previewShape-colorDisk-76*20;
        trialsInfo[curTrial].responseC = 1; 
        repsonse_tmp = trialsInfo[curTrial].responseC;
        if (trialsInfo[curTrial].matchType == 'new' && repsonse_tmp == 1) {
            $('#Instruction6').show();
        } 
        rt_tmp = trialsInfo[curTrial].reactTime;
        if (rt_tmp > 4500) {
            $('#Instruction7').show();
        }
    }
    if (e.key == '0') {
        endTrialTime = new Date();
        window.cancelAnimationFrame(myReq);
        clearTimeout(myTimeout);
        refresh_stimuliOnset_test = 0;
        occluder_velX = 0;
        occluder_velY = 40;//40
        occluder_posX = 0;
        occluder_posY = 0;
        $('#canvas_L').hide();
        $('#Instruction4').show();
        if (trainingTrial <= trialsInfo_training.length-1) {
            $('#nextTrainingTrialButton').show();
        } 
        if (trainingTrial == trialsInfo_training.length && curTrial>=0) {
            $('#nextTrialButton').show();
        }
        balls_A[0].x = canvasWidth/2-230;
        balls_A[0].y = canvasHeight/2;
        balls_B[0].x = canvasWidth/2+230;
        balls_B[0].y = canvasHeight/2;   

         if (curTrial ==0 && trainingTrial >=0 && trainingTrial < trialsInfo_training.length) {
            trialsInfo_training[trainingTrial].endTime = endTrialTime;
            trialsInfo_training[trainingTrial].reactTime = endTrialTime - startTrialTime-colorDisk-previewShape-colorDisk-76*20;
            trialsInfo_training[trainingTrial].responseC = 0;
            repsonse_tmp = trialsInfo_training[trainingTrial].responseC;
            if (trialsInfo_training[trainingTrial].matchType == 'same' && repsonse_tmp == 0) {
                $('#Instruction6').show();
            } 
            if (trialsInfo_training[trainingTrial].matchType == 'same_swap' && repsonse_tmp == 0) {
                $('#Instruction6').show();
            }
            rt_tmp = trialsInfo_training[trainingTrial].reactTime;
            if (rt_tmp > 4500) {
                $('#Instruction7').show();
            }
        }


        trialsInfo[curTrial].endTime = endTrialTime;
        trialsInfo[curTrial].reactTime = endTrialTime - startTrialTime-colorDisk-previewShape-colorDisk-76*20;
        trialsInfo[curTrial].responseC = 0;
        repsonse_tmp = trialsInfo[curTrial].responseC;
         if (trialsInfo[curTrial].matchType == 'same' && repsonse_tmp == 0) {
            $('#Instruction6').show();
        }  
         if (trialsInfo[curTrial].matchType == 'same_swap' && repsonse_tmp == 0) {
            $('#Instruction6').show();
        }
        rt_tmp = trialsInfo[curTrial].reactTime;
        if (rt_tmp > 4500) {
            $('#Instruction7').show();
        }
    }
}           
}, false);

//window.addEventListener ('keydown', function(e){
  //  if (e.key === "Enter" || e.which == 13){
    //          continueInstruction1();
      //     } 
        //}, false) ;

// window.addEventListener ('keydown', function(e){
//     if (e.key === "Enter" || e.which == 13){
//         if (trainingTrial == 0 ) {
//               showTrials_training_0();
//            } 
//        }
//         }, false) ;

// window.addEventListener ('keydown', function(e){
//     if (e.key === "Enter" || e.which == 13){
//         if (curTrial == 0 ) {
//               showTrials_training_0();
//            } 
//        }
//         }, false) ;

// window.addEventListener ('keydown', function(e){
//     if (e.key === "Enter" || e.which == 13){
//         if (trainingTrial <= trialsInfo_training.length-1 && trainingTrial > 0 ) {
//               showTrials_training();
//            } 
//        }
//         }, false) ;

// window.addEventListener ('keydown', function(e){
//     if (e.key === "Enter" || e.which == 13){
//       if (curTrial <= trialsInfo.length - 1 && curTrial>0) {
//               showTrials_exp();
//            } 
//        }
//         }, false) ;


// save json file to local device
function doneExperiment() {
    JSONObj = JSON.stringify(window.frame);
    download(JSONObj, "test_data.json", "json"); 
};
/* wait for clicks */
$('#continueInstructionButton1').click(continueInstruction1);
$('#startTrainingButton').click(showTrials_training_0);
$('#nextTrainingTrialButton').click(showTrials_training);
$('#startExpButton').click(showTrials_exp_0);
$('#nextTrialButton').click(showTrials_exp);

// $('#submitButton').attr("onclick", "doneExperiment()");
$('#submitButton').attr("onclick", "postData()");

// this script is written by Qihan Wu on 10/11/2022 for experiments investigating what dominates object correspondece
</script>

